<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
      button,
      input[type="submit"] {
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <main class="border h-dvh flex flex-col items-center gap-2 p-15">
      <form class="border w-full flex items-center gap-3 p-2">
        <input
          type="text"
          placeholder="Enter a name"
          class="border flex-1 h-10 px-3"
        />
        <input
          type="submit"
          value="Submit"
          class="h-10 border px-5 hover:bg-black hover:text-white"
        />
      </form>
      <ul class="w-full p-2 flex-1 overflow-y-auto flex flex-col gap-3"></ul>
    </main>

    <script
      src="https://code.jquery.com/jquery-3.7.1.js"
      integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.14.1/jquery-ui.min.js"
      integrity="sha512-MSOo1aY+3pXCOCdGAYoBZ6YGI0aragoQsg1mKKBHXCYPIWxamwOE7Drh+N5CPgGI5SA9IEKJiPjdfqWFWmZtRA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script>
      let store = JSON.parse(localStorage.getItem("Task")) || [];
      let editMode = null;

      function showToast(msg, color) {
        const $toast = $("<div>").text(`${msg}`).css({
          position: "fixed",
          top: "10px",
          right: "0px",
          backgroundColor: color,
          color: "#fff",
          zIndex: "1000",
          padding: "10px 20px",
          borderRadius: "10px",
          opacity: "0"
        });

        $("body").append($toast);

        $toast.animate({
          opacity: 1,
          right: "10px"
        }).delay(1000).fadeOut(400, function(){
          $(this).remove()
        })
      }

      $("main form").submit((e) => {
        e.preventDefault();
        const $val = $(e.target).find("input[type='text']").val();

        if (editMode !== null) {
          store = store.map((t) =>
            t.id === editMode ? { ...t, name: $val } : t
          );
          editMode = null;
          showToast("Task updated", "orange")
        } else {
          store = [...store, { id: store.length + 1, name: $val }];
          showToast("New Task added", "greenyellow");
        }
        localStorage.setItem("Task", JSON.stringify(store));
        // console.info(store)
        renderTask(store);
      });

      function renderTask(store) {
        // $("main ul").html("");
        $("main ul").html(`
            ${
              store.length > 0
                ? `
                    ${store
                      .map(
                        (item, idx) => `
                        <li class="flex items-center gap-2 shadow-xl p-2">
                            <div>${idx + 1}</div>
                            <div class="flex-1">${item.name}</div>
                            <div>
                                <button onclick="handleEdit(${item.id})"
                                class="w-15 border text-lime-400 hover:bg-lime-400 hover:text-white"
                                >
                                Edit
                                </button>
                            </div>
                            <div>
                                <button onclick="handleDelete(${item.id})"
                                class="w-15 border text-orange-400 hover:bg-orange-400 hover:text-white"
                                >
                                Delete
                                </button>
                            </div>
                        </li>
                    `
                      )
                      .join("")}
                `
                : `
                <li class="text-center">No Task found</li>
            `
            }
        `);

        $("ul li").show("drop", { direction: "up" }, 100);
      }
      renderTask(store);

      // Update function
      function handleEdit(id) {
        const valFound = store.find((t) => t.id === id);

        $("main form input[type='text']").val(valFound.name);

        editMode = id;
        showToast("Edit mode", "skyblue")
      }

      // Delete function
      function handleDelete(id) {
        store = store.filter((t) => t.id !== id);

        localStorage.setItem("Task", JSON.stringify(store));
        renderTask(store);
        showToast("Task deleted", "red")
      }
    </script>
  </body>
</html>
